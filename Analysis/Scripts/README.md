# Offline Analysis Overview  
This folder contains RMarkdown files for each species, in which we present example analyses. These analyses include hierarchical clustering and principal component analyses of species samples, limma-voom differential expression (example result echoing analyses completed by the Shiny App), benchmarking of differential expression analyses against previously published datasets, and an example gene set enrichment analysis. Rmd files are knitted into html files, and both PCA and Benchmarking plots are saved in a Plot subfolder in the Outputs folder.  

See sections below for descriptions of the analyses included in the .rmd files.  

## Table of Contents  
1. [Overview of RMD Files](#overview-of-rmd-files)
1. [Clustering Analysis](#clustering-analysis)
2. [Differential Gene Expression](#example-of-differential-gene-expression-analysis)
3. [Benchmarking](#benchmarking)
4. [Functional Enrichment Analysis](#functional-enrichment-analysis)
5. [Regarding *S. venezuelensis* Data Analyses](#note-s-venezuelensis-data-analyses)

## Overview of .rmd/.html Files  
For all species, the offline Data Analysis RMarkdown file contains cluster analyses, examples of differential gene expression analyses conducted by the *Strongyloides* RNAseq Browser, and benchmarking comparisons against previously published datasets. Data files used as inputs for these analyses include the `SxRNAseq_data_preprocessed` and `Sx_vDGEList` R objects generated by the Pre-processing scripts. The code and results generated by the RMarkdown files are knitted into html files.  

## Clustering Analysis
The RMarkdown files first implement hierarchical clustering and PCA analyses on the data. Heirarchical clustering performed on filtered and normalized abundance data using the "complete" method. Identified principal components undergo additional analysis in order to determine which genes are influencing the identified PCs; an annotated list of genes that are the 10% of contributors (in any direction) to PC1 and PC2 is printed. Various graphs are plotted, including a dendrogram of the heirachical clustering, and several plots of visualize the PCA. PCA plots are saved in the Output folder (in the Plots subfolder).  

Next, we visualze gene expression across life stages by generating a heatmap for all the genes using variance-stabilized Log2CPM values. For heatmaps, columns (life stages) are ordered using Spearman clustering of expression in all genes (not just the user-defined subset). Rows are ordered using Pearson clustering.  

## Example of Differential Gene Expression Analysis
The `limma` package ( [Ritchie *et al* 2015](https://pubmed.ncbi.nlm.nih.gov/25605792/), [Phipson *et al* 2016](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5373812/)) is used to conduct pairwise differential gene expression analyses between life stages. For each species, an example pairwise comparison between two life stages is displayed as a volcano plot and interactive DataTable:

  * *S. stercoralis*: iL3 vs FLF  
  * *S. ratti*: iL3 vs FLF  
  * *S. papillosus*: iL3 vs FLF  
  * *S. venezuelensis*: PF vs FLF  

## Benchmarking
Next, we benchmark the results of our differential gene expression analysis against a published analsysis:

  * *S. stercoralis*: We use Supplementary Table 5 from [Hunt *et al* 2016](https://www.nature.com/articles/ng.3495), which includes the results of edgeR differential gene expression analysis between multiple life stages.  
  * *S. ratti*: We use Supplementary Table 5 from [Hunt *et al* 2016](https://www.nature.com/articles/ng.3495), which includes the results of edgeR differential gene expression analysis between multiple life stages.  
  * *S. papillosus*: Tables with data suitable for benchmarking are not currently available.  
  * *S. venezuelensis*: We use Supplementary Table 1 from [Hunt *et al* 2018](https://www.nature.com/articles/s41598-018-23514-z), which includes the results of edgeR differential gene expression analysis between free living females and parasitic females. Note that we manually adjust the geneID names in Table S1 in order to match current Wormbase ParaSite nomenclature, such that 'SVE_' is used instead of 'SVEN_'.  

## Functional Enrichment Analysis
Finally, we perform gene set enrichment analysis using the GSEA function from the `clusterProfiler` R package [(Yu et al 2012)](http://dx.doi.org/10.1089/omi.2011.0118). The goal of GSEA is to determine whether the members of a predefined set of genes are randomly distributed throughout a ranked gene list. Thus, GSEA depends on the availability of gene sets. Here, we use a Ensembl Compara protein family set list defined in [(Hunt *et al* 2016)](https://www.nature.com/articles/ng.3495). Note that the original set list uses specific transcript information, which we discard. The R script used to assemble the gene set list for use in this app is publically available as part of this repository (Pre_processing subfolder > `generateGeneSet.R`).  

For the example pairwise comparisons, the ranked gene list is constructed by rank ordering by LogFC. The GSEA analysis returns a plot of enriched gene families as well as a table containing normalized gene enrichment scores. These scores represent the degree to which the elements of the gene set are over-represented at the edges of the ranked gene list. Scores are normalized based on the number of genes within the gene set.

## Note: *S. venezuelensis* Data Analyses
For *S. venezuelensis* we perform some of the offline analyses iteratively. Available *S. venezuelensis* samples were prepared using different libary construction methods (amplified vs non-amplified), sequencing run batches, and machines [(Hunt *et al* 2018)](https://www.nature.com/articles/s41598-018-23514-z). Dividing the experiments based on sequencing instrument produces two batches:  

  1. Group FLF_PF: This set includes 2 life stages with 3 biological replicates and two technical replicates per life stage:  
    i) Free-living females (FLF)  
    ii) Parasitic adult females (PF)   
  2. Group iL3_extended:   
    i) Egg: 1 biological replicate and two technical replicates  
    ii) 1st stage larvae (L1): 1 biological replicate and two technical replicates  
    iii) Infective third-stage larvae (iL3): 1 biological replicate and two technical replicates  
    iv) activated iL3s (iL3a) - 1 day: 1 biological replicate  
    v) activated iL3s (iL3a) - 5 day: 1 biological replicate  
    vi) iL3s removed from the lungs (iL3_lung): 1 biological replicate and two technical replicates  
    vii) Young free-living adult females (Young_FLF): 1 biological replicate and two technical replicates  
    viii) Free-living adult females (FLF): 1 biological replicate and two technical replicates  

Both batches contain data from Free-living females; this thereotically permits batch correction. Thus, we initially pre-processed and analyzed all samples together using limma-based batch correction methods. However, we observed that following batch correction there were still substantial differences between FLF groups from the two batches. PCA and hierarchical clustering analyses of non-batch-corrected and batch-corrected data are reported in Appendix I of the *S. venezuelensis* RNAseq Data Analysis document (Sv_RNAseq_Data_Analysis.html/.rmd).  

Therefore, we have taken the conservative approach of treating these two batches separately, and have only included the batch containing robust biological replicates (Group FLF_PF) in the *Strongyloides* RNAseq Browser App and in the main analyses included in the files within this subfolder.

